(()=>{"use strict";const e=window.wc.blocksCheckout,t=window.React,a=window.wp.element,n=window.wp.data,r=JSON.parse('{"apiVersion":2,"name":"german-market/eu-vat-id","version":"2.0.0","title":"German Market EU VAT ID Check","category":"german-market","description":"Adds the German Market EU VAT ID Check to the checkout","supports":{"html":false,"align":false,"multiple":false,"reusable":true,"lock":false},"parent":["woocommerce/checkout-fields-block","woocommerce/checkout-totals-block"],"textdomain":"woocommerce-german-market"}');(0,e.registerCheckoutBlock)({metadata:r,component:({cart:r,checkoutExtensionData:o,extensions:s,children:c})=>{const{setValidationErrors:i,clearValidationError:l}=(0,n.useDispatch)("wc/store/validation"),m="german-market-eu-vat-id",{setExtensionData:d}=o;let u="",k="",p=!1,g=!1,_="",v="",b="",h="",E="",w="",f="";s["german-market-store-api-integration"]&&(E=s["german-market-store-api-integration"].vat_id_data.default_value,g=s["german-market-store-api-integration"].vat_id_data.required,p=s["german-market-store-api-integration"].vat_id_data.show,k=s["german-market-store-api-integration"].vat_id_data.label,u=s["german-market-store-api-integration"].vat_id_data.country,b=s["german-market-store-api-integration"].vat_id_data.required_error_if_empty,h=s["german-market-store-api-integration"].vat_id_data.validating,v=s["german-market-store-api-integration"].vat_id_data.last_error,w=s["german-market-store-api-integration"].vat_id_data.is_success,f=s["german-market-store-api-integration"].vat_id_data.last_validated_number,_=v&&""!==v?s["german-market-store-api-integration"].vat_id_data.default_error:""),g&&(k+=" *");const[y,C]=(0,a.useState)(E);let N=!1;w&&f===y&&(N=!0);let x=document.getElementById(m),A=!1;x&&(A=!0,x.parentElement.setAttribute("data-validating-string",h),N&&(x.parentElement.classList.contains("validating")||x.parentElement.classList.add("validation-success")));const V=(0,a.useCallback)((()=>{const e=document.getElementById(m);e&&e.parentElement.classList.remove("validation-success")}),[m]),B=e=>{d("german-market-eu-vat-id-store-api-integration","billing_vat",e)};(0,a.useEffect)((()=>{C(E),B(E)}),[E]);const[I,L]=(0,a.useState)(!1),D=(0,a.useRef)(Promise.resolve()),q=(0,a.useCallback)((()=>{const e=document.getElementsByClassName("wc-block-components-checkout-place-order-button");Array.prototype.forEach.call(e,(e=>{e.setAttribute("disabled",!0)}))}),[]),F=(0,a.useCallback)((()=>{const e=document.getElementsByClassName("wc-block-components-checkout-place-order-button");Array.prototype.forEach.call(e,(e=>{e.removeAttribute("disabled")}))}),[]),S=(0,a.useCallback)((async()=>{const t=document.getElementById(m);t&&(t.parentElement.classList.add("validating"),t.parentElement.classList.remove("validation-success")),q(),""!==y&&l(m);try{const a=await(0,e.extensionCartUpdate)({namespace:"german-market-blocks-eu-vat-id",data:{show:p,country:u,vat_number:y}}),n=a?.extensions?.["german-market-store-api-integration"]?.vat_id_data,r=n?.is_success,o=n?.last_validated_number,s=n?.last_error;return t&&r&&o===y&&t.parentElement.classList.add("validation-success"),s&&""!==s?(_=n?.default_error||"",i({[m]:{message:_,hidden:!1}})):(_="",g||l(m)),a}finally{F(),t&&t.parentElement.classList.remove("validating")}}),[l,y,u,m,g,i,p,q,F]),T=(0,a.useCallback)((()=>(D.current=D.current.catch((()=>{})).then((()=>S())),D.current)),[S]);(0,a.useEffect)((()=>{p||L(!1)}),[p]),(0,a.useEffect)((()=>{A&&!I&&(T(),L(!0))}),[T,A,I]),(0,a.useEffect)((()=>{T(),p||B("")}),[T,u,p]);const U=(0,a.useCallback)((()=>{T()}),[T]);(0,a.useEffect)((()=>{""===_?""!==_||g||l(m):i({[m]:{message:_,hidden:!1}})}),[_,i,l]);let G=(0,t.createElement)(t.Fragment,null);return p&&(G=(0,t.createElement)(t.Fragment,null,(0,t.createElement)("fieldset",{className:"wc-block-checkout__shipping-option wp-block-woocommerce-checkout-shipping-methods-block wc-block-components-checkout-step wc-block-components-checkout-step--with-step-number"},(0,t.createElement)("legend",{className:"screen-reader-text"},k),(0,t.createElement)("div",{className:"wc-block-components-checkout-step__heading"},(0,t.createElement)("h2",{className:"wc-block-components-title wc-block-components-checkout-step__title","aria-hidden":"true"},k)),(0,t.createElement)("div",{className:"wc-block-components-checkout-step__container"},(0,t.createElement)("div",{className:"wc-block-components-checkout-step__content"},(0,t.createElement)(e.ValidatedTextInput,{className:"billing_vat german-market-billing-vat-block",id:m,label:k,value:y,required:!1,onChange:e=>{B(e),V(),C(e)},onBlur:U,onFocus:q,errorId:m,customValidation:e=>!g||""!=e.value||(e.setCustomValidity(b),!1)})))))),G}})})();